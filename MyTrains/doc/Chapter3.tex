% Activate the following line by filling in the right side. If for example the name of the root file is Main.tex, write
% "...root = Main.tex" if the chapter file is in the same directory, and "...root = ../Main.tex" if the chapter is in a subdirectory.
 
%!TEX root =  

\chapter[Updating Firmware]{Updating Firmware}

\section{Firmware Parameters}

\begin{tabular}{l l l l l l l l l l l l}
\underline{Prod. Code} & \underline{Device} & \underline{BLV} & \underline{HWV} & \underline{SWV} & \underline{CHKS} & \underline{DLY} & \underline{OPT} & \underline{PBLK} & \underline{EBLK} & \underline{EDLY}\\
0x01 & LNRP & 1 & 0 & 3 & 64 & 8 & 1 & 64 & 64 & 8\\
0x04 & UT4\\
0x06 & UT6 & 2 & 0 & 1 & 64 & 11 & 2 & 512 & 4096 & 40\\
0x0C & WTL12\\
0x14 & DB210 Opto & 2 & 1 & 2 & 64 & 7 & 2 & 512 & 4096 & 25\\
0x15 & DB210 & 2 & 1 & 2 & 64 & 7 & 2 & 512 & 4096 & 25\\
0x16 & DB220 & 2 & 1 & 2 & 64 & 7 & 2 & 512 & 4096 & 25\\
0x1A & DCS210+\\
0x1B & DCS210 & 2 & 1 & 3 & 64 & 5 & 2 & 256 & 2048 & 40\\
0x1C & DCS240 & 2 & 1 & 3 & 64 & 5 & 2 & 256 & 2048 & 40\\
0x23 & PR3 & 1 & 0 & 8 & 64 & 5 & 1 & - & - & -\\
0x24 & PR4 & 0 & 0 & 0 & 64 & 5 & 2 & 256 & 2048 & 60\\
0x2A & DT402 & 1 & 0 & 17 & 64 & 15 & 1 & 64 & 64 & 15\\
0x32 & DT500 & 1 & 0 & 1 & 64 & 15 & 1 & 64 & 64 & 15\\
0x33 & DCS51 & 1 & 0 & 5 & 64 & 12 & 1 & - & - & -\\
0x34 & DCS52 & 2 & 0 & 1 & 64 & 11 & 2 & 512 & 4096 & 40\\
0x3E & DT602 & 2 & 0 & 1 & 64 & 11 & 2 & 512 & 4096 & 40\\
0x51 & BXPA1 & 2 & 0 & 1 & 64 & 6 & 2 & 512 & 4096 & 41\\
0x58 & BXP88 & 2 & 0 & 2 & 64 & 50 & 2 & 256 & 2048 & 100\\
0x5C & UR92 & 0 & 1 & 8 & 64 & 16 & 1 & 64 & 64 & 16\\
0x5D & UR93 & 2 & 0 & 0 & 64 & 5 & 2 & 512 & 4096 & 25\\
0x63 & LNWI & 2 & 1 & 2 & 64 & 5 & 2 & 512 & 4096 & 25\\
\end{tabular}

\section{DMF File Format}
 
The manufacturer's DMF file format is a modified form of the Intel Hexadecimal Object File Format. Character encoding is ASCII. The file consists of multiple ``records" each terminated by an ASCII linefeed character (0x0A). There are four types of record and they appear in the file in the following order:

\begin{enumerate}
\item Sync records
\item Parameter records
\item Data records
\item End of File record
\end{enumerate}

\subsection{Sync Records}
Sync records are used to identify the file as a DMF file. There are six sync records each consisting of a single ASCII \# character (0x23).

Example:

\begin{verbatim}
#
#
#
#
#
#
\end{verbatim}

\subsection{Parameter Records}

\begin{center}
\begin{tabular}{| c | c | c | c | }
\hline
PARAM MARK & PARAMETER NAME & NAME TERMINATOR & VALUE\\
\hline
! (0x21) $<$SPC$>$ (0x20) & ASCII text & : (0x3A) $<$SPC$>$ (0x20) & decimal value \\
\hline
2 bytes & variable bytes & 2 byte & variable bytes\\
\hline
\end{tabular}

PARAMETER RECORD FORMAT
\end{center}

Parameter records start with a two byte PARAM MARK. This consists of the ASCII code for the exclamation mark (0x21) followed by the ASCII code for the space character (0x20). The PARAMETER NAME is next. The PARAMETER NAME is ASCII encoded text identifying the parameter. The PARAMETER NAME may include spaces. It is terminated by the NAME TERMINATOR which consists of the ASCII code for a colon (0x3A) followed by the ASCII code for a space character (0x20). The last field is the VALUE field. This is a decimal numeric value encoded as ASCII text.

The following parameters have been identified and they are presented in the following order (it is not known if the order is significant):

\begin{enumerate}
\item Bootloader Version
\item Manufacturer Code
\item Product Code
\item Hardware Version
\item Software Version
\item Chunk Size
\item Delay
\item Options
\item First Address
\item Last Address
\item Prog Blk Size
\item Erase Blk Size
\item Erase Dly
\end{enumerate}

Example:

\begin{verbatim}
! Bootloader Version: 2
! Manufacturer Code: 0
! Product Code: 88
! Hardware Version: 0
! Software Version: 2
! Chunk Size: 64
! Delay: 50
! Options: 2
! First Address: 24576
! Last Address: 73728
! Prog Blk Size: 256
! Erase Blk Size: 2048
! Erase Dly: 100
\end{verbatim}

\subsection{Data Records}

\begin{center}
\begin{tabular}{| c | c | c | c | c | c |}
\hline
RECORD MARK & RECLEN & LOAD OFFSET & RECTYP & DATA & CHKSUM \\
(:) &  &  &  &  &  \\
\hline
1 byte & 2 bytes & 6 bytes & 2 bytes & n bytes & 2 bytes \\
\hline
\end{tabular}

DATA RECORD FORMAT
\end{center}

The data record provides a set of hexadecimal digits that represent the ASCII code for data bytes that make up a portion of a memory image. 

Each data record begins with a RECORD MARK field containing the ASCII code for the colon (:) character (0x3A).

Each record has a RECLEN field which specifies the number of bytes of data which follows the RECTYP field of the record. Note that one data byte is represented by two ASCII characters. The maximum value of the RECLEN field is hexadecimal ``FF'' or 255. Although the maximum is 255, the manufacturer seems to prefer 64.

Each record has a LOAD OFFSET field which specifies the 24-bit starting load offset of the data bytes. 

The RECTYP field for data records is ``00".
 
Each record has a variable length DATA field, it consists of zero or more bytes encoded as pairs of hexadecimal digits. 

Each record ends with a CHKSUM field that contains the ASCII hexadecimal representation of the two's complement of the 8-bit bytes that result from converting each pair of ASCII hexadecimal digits to one byte of binary, from and including the RECLEN field to and including the last byte of the DATA field. Therefore, the sum of all the ASCII pairs in a record after converting to binary, form the RECLEN field up to and including the CHKSUM field, is zero.

The contents of the individual fields within the record are:

\begin{tabular}{l p{10cm}}
RECORD MARK & This field contains 0x3A, the encoding of the ASCII colon (:) character. \\
& \\
RECLEN & The field contains two ASCII hexadecimal digits that specify the number of data bytes in the record. The maximum value is ``FF'' or 0x4646 (255 decimal). \\
& \\
LOAD OFFSET & This field contains six ASCII hexadecimal digits representing the address at which the first byte of the data is to be placed. Most significant digit is presented first.\\
& \\
RECTYP & This field contains 0x3030, the hexadecimal encoding of the ASCII characters ``00'', which specifies the record type to be a data record. \\
& \\
DATA & This field contains pairs of ASCII hexadecimal digits, one pair for each data byte. \\
& \\
CHKSUM & This field contains the check sum on the RECLEN, LOAD OFFSET, RECTYP, and DATA fields. \\
\end{tabular}

Example:

\begin{verbatim}
:400060000057AAC3880FAAC388559AC38855AAC388553AC38855AAC38855AAC3884A0
0C38855AAC38855AAC3882DFCC38861B8C3882DFCC38861B8C3882DFCC38861B8C3886D
\end{verbatim}

\subsection{End of File Record}

\begin{center}
\begin{tabular}{| c | c | c | c | c |}
\hline
RECORD MARK & RECLEN & LOAD OFFSET & RECTYP & CHKSUM \\
(:) & ``00'' & ``000000'' & ``01'' & ``FF''  \\
\hline
1 byte & 2 bytes & 6 bytes & 2 bytes & 2 bytes \\
\hline
\end{tabular}

END OF FILE RECORD FORMAT
\end{center}

The End of File Record specifies the end of the file.

The contents of the individual fields within the record are:

\begin{tabular}{l p{10cm}}
RECORD MARK & This field contains 0x3A, the encoding of the ASCII colon (:) character. \\
& \\
RECLEN & The field contains 0x3030, the hexadecimal encoding of the ASCII characters ``00''. Since this record does not contain any DATA bytes, the length is zero. \\
& \\
LOAD OFFSET & This field contains 303030303030H, the hexadecimal encoding of the ASCII characters ``000000'', since this field is not used for this record. \\
& \\
RECTYP & This field contains 0x3031, the hexadecimal encoding of the ASCII characters ``01'', which specifies the record type to be an End of File Record. \\
& \\
CHKSUM & This field contains the check sum on the RECLEN, LOAD OFFSET, and RECTYP fields. Since all the fields are static, the check sum can also be calculated statically, and the value is 4646H, the hexadecimal encoding of the ASCII characters ``FF''. \\
\end{tabular}

Example:

\begin{verbatim}
:0000000001FF
\end{verbatim}

