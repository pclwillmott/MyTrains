% Activate the following line by filling in the right side. If for example the name of the root file is Main.tex, write
% "...root = Main.tex" if the chapter file is in the same directory, and "...root = ../Main.tex" if the chapter is in a subdirectory.
 
%!TEX root =  

\chapter[Configuration Variables]{Programming Configuration Variables (CVs)}\index{Configuration Variables}\index{CVs|see {Configuration Variables}} 	

\section{Introduction}

The decoders installed in your locomotives provide you with the ability to create a more realistic operating experience through the configuration variables (CVs for short). The network protocol supports configuration of up to
1024 CVs.

It is a good idea to run your decoders with the default CV values that come pre-programmed in your decoders until you get used to the performance characteristic and how they work on your layout. Once you are comfortable with running the trains, then you can begin customizing locomotive characteristics.

Each CV (configuration variable) controls a specific characteristic of the decoder, which in turn controls how the locomotive performs. See your decoder manual for a list of the most commonly used CVs and their meanings.
Each decoder comes pre-programmed from the factory with the default settings outlined in your decoder manual. You can change your decoderâ€™s performance characteristics by changing the CV values entered in the CVs you want to change. Each of these CVs can be set up when your command station is in the programming mode. The CVs are remembered in the decoder until it is reprogrammed to with a different CV value. Please refer to your mobile decoder manual for a complete listing of the CVs supported by each decoder.

Programming decoder CVs is usually done on an isolated programming track.

There are four programming modes:

\begin{itemize}
\item Paged mode
\item Physical register mode
\item Direct mode
\item Operations mode
\end{itemize}

\subsection{Paged Mode Programming}\index{Programming!Paged Mode}

\subsection{Physical Register Programming}\index{Programming!Physical Register Mode}
Physical Register Mode can only read CV01-CV08. You should not rely on values in the display for CVs above 08 when reading back in physical register mode.

\subsection{Direct Mode Programming}\index{Programming!Direct Mode}
This is the preferred programming mode.

\subsection{Operations Mode Programming}\index{Programming!Operations Mode}
Operations mode programming lets you program CVs in locomotives equipped with Extended Packet Format decoders while they are on the mainline. A typical use for Ops mode programming would be to change the acceleration rate (CV03) or the deceleration rate (CV04) of your locomotives to simulate the weight and braking capability of the train to compensate for changing the number of cars or power units on a train.

Operations Mode read back can only be used with decoders that are capable of operations mode read back when there is a device attached to the network that supports operations mode read back. Digitrax transponding decoders and the DCS210 or DCS240 command stations would allow operations mode read back.

\section{Programming Mobile Decoder Addresses}

Be sure that only the loco you want to program is on the programming track. If you are using operations mode programming, the loco you want to program can be anywhere on the layout but it must have a decoder that is capable of operations mode programming installed.

There are two addressing methods - short and long. The short addresses can take a value between 0 and 127, and long addresses a value between 128 and 9983. The bit 5 of mobile decoder's configuration register (CV29) determines what addressing method is used. If bit 5 is set to 1 then long addresses are used, and when bit 5 is 0 then short addresses are used. Short addresses are stored in CV1, and long addresses in CV17 and CV18. The address values stored in CV17 and CV18 are not the high and low bytes of the address value. The CV17 and CV18 values must be calculated from the address value as follows:

TEMP = address + 49152

CV18 = TEMP \& 0xFF

CV17 = TEMP $>>$ 8

Example:

address = 4007

TEMP = 49152 + 4007 = 53159 = 0xCFA7

CV18 = 0xA7 = 167

CV17 = 0xCF = 207

read cv

\begin{verbatim}

Read CV
unknown
   65830.9ms 
<D0> 0xef 0b11101111 <- OPC_PROG
<D1> 0x0e 0b00001110 <- Message Length
<D2> 0x7c 0b01111100 <- Special programming slot number
<D3> 0x2b 0b00101011 <- PCMD

d7 0
d6 0 - read
d5 1 - byte mode
d4 0 - TV1
d3 1 - TV0 
d2 0 - service mode on programming track
d1 1 - unknown
d0 1  - unknown

Direct mode byte read on service track

<D4> 0x00 0b00000000 - 0x00
<D5> 0x00 0b00000000 - HOPSA - Ops mode programming - 7 high address bits of Loco to program, 0x00 if service mode
<D6> 0x0e 0b00001110 - LOPSA - Ops Mode programming - 7 low address bits of loco to program, 0x00 if service mode (however 0e is the loco address)
<D7> 0x00 0b00000000 - TRK - normal track status for command station - this doesn't look right set to 0x00 for send
<D8> 0x00 0b00000000 - CVH
<D9> 0x00 0b00000000 - CVL
<D10> 0x0f 0b00001111 - DATA
<D11> 0x6d 0b01101101 - Throttle serial number
<D12> 0x52 0b01010010 - Throttle serial number
<D13> 0x77 0b01110111 

response
    1722.5ms 
<D0> 0xe7 0b11100111 <- Opcode
<D1> 0x0e 0b00001110 <- length
<D2> 0x7c 0b01111100 <- Programming slot
<D3> 0x2b 0b00101011 <- PCMD
<D4> 0x00 0b00000000 <- PSTAT - success
<D5> 0x00 0b00000000 <- HOPSA
<D6> 0x02 0b00000010 <- LOPSA should be 0
<D7> 0x47 0b01000111 <- TRK
<D8> 0x02 0b00000010 <- CVH : 0, 0, CV9, CV8, 0, 0, D7, CV7
<D9> 0x04 0b00000100 <- CVL - CV5
<D10> 0x16 0b00010110  <- low 7 bits of value
<D11> 0x6d 0b01101101 <- SN
<D12> 0x52 0b01010010  <- SN
<D13> 0x2b 0b00101011 <- CHK
\end{verbatim}

value displayed is 150 10010110

PCMD

\begin{tabular}{l l}
d7 & 0\\
d6 & 1 = write, 0 = read\\
d5 & 1 = byte operation, 0 = bit operation (if possible)\\
d4 & TV1\\
d3 & TV0\\
d2 & 1 = Ops mode on mainlines, 0 = service mode on programming track\\
d1 & 0 - reserved\\
d0 & 0 - reserved\\
\end{tabular}

\begin{tabular}{l l l l l}
\underline{Byte Mode} & \underline{Ops Mode} & \underline{TV1} & \underline{TV0} & \underline{Meaning} \\
1 & 0 & 0 & 0 & Paged mode byte read/write on service track\\
1 & 0 & 0 & 1 & Direct mode byte read/write on service track\\
0 & 0 & 0 & 1 & Direct mode bit read/write on service track\\
$\times$ & 0 & 1 & 0 & Physical register byte read/write on service track\\
$\times$ & 0 & 1 & 1 & Service track reserved function\\
1 & 1 & 0 & 0 & Ops mode byte program no feedback\\
1 & 1 & 0 & 1 & Ops mode byte program with feedback\\
0 & 1 & 0 & 0 & Ops mode bit program no feedback\\
0 & 1 & 0 & 1 & Ops mode bit program with feedback\\
\end{tabular}

