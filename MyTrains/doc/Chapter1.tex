% Activate the following line by filling in the right side. If for example the name of the root file is Main.tex, write
% "...root = Main.tex" if the chapter file is in the same directory, and "...root = ../Main.tex" if the chapter is in a subdirectory.
 
%!TEX root =  

\chapter[Network Protocol]{The Network Protocol}.  

\section{Overview}

Loconet is a peer to peer distributed network system on which all devices can monitor the network data flow. The network is event driven by different devices in time, and is not polled by a centralised controller in normal operation. The normal the network state is idle, with no data traffic unless a device has information to send. With no traffic flow, the network is quiet.

The network data is sent in asynchronous format using 1 start bit, 8 data bits and 1 stop bit. The 8 bit data is transmitted least significant bit first. The bit times are 60.0 $\mu$S or 16,660 baud +/- 1.5\%. A computer can connect to a Digitrax USB interface at higher baud rates and the device will make the necessary conversion. Bytes may be transmitted back-to-back, with a start bit immediately following the stop bit of the previous character. 

Any message that has format or framing errors, data errors or is a fragment caused by noise glitches and does not completely follow the message format will be ignored by all receivers, and a new opcode will be scanned for re-synchronisation.

The OPC\_BUSY opcode is included to allow the master to keep the network active whilst it is performing a task that requires a response, and entails a significant processing delay, i.e. it can ensure no new requests are started until it has responded to the last message. This OPC\_BUSY opcode should be simply stripped and ignored.

If a device disconnects from the network and so does not access or reference a slot within the system purge time, the command station will force the un-accessed slot to common status so other system devices can use the slot. The typical purge time of a command station is about 200 seconds. A good ``ping" or slot update activity is about every 100 seconds, i.e. if a user makes no change to a throttle/slot within 100 seconds, the throttle/device should automatically send another speed update at the current speed to reset the purge timeout for that slot.

\section{Message Format}

All the network communications are via multi-byte messages. The command station is defined as the device that is maintaining the refresh stack for DCC packet generation and is actively generating the DCC track data. Refresh of information is typically only performed for mobile decoders. Stationary type decoders are not refreshed and individual immediate commands are sent out to the track as requested.

The command station is only privileged in respect to performing the task of maintaining the locomotive refresh stack and generating DCC packets. In this way other network transactions may occur that the command station does not need to be involved with or understand, as long as they follow the message protocol and timing requirements. i.e. other devices may have a dialog on the network without disturbing or involving the command station. Devices on the network monitor the messages, check for format and data integrity and parse good messages to decode if action is required in the context. Devices such as throttles, input sensors, computer interfaces and control panels may generate the network messages without needing prompting or polling by a central controller.

Devices frequently will be added and removed from an operating the network. The devices and protocol are tolerant of electrical and data transients. The format chosen gives a good degree of data integrity, guaranteed quick network-state synchronisation, high data throughput, good distribution of access to many competing devices and low event latency. Also, the devices may be operated without need for unique ID or other requirements that can make network administration awkward.

The data bytes on the Network are defined as 8 bit data with the most significant bit as an opcode flag bit. If the most significant bit, d7, is 1 then the 7 least significant bits are interpreted as a network opcode . The opcode byte may only occur once in a valid message and is the first byte of a message. All the remaining bytes in the message must have a most significant bit of 0, including the last checksum byte. The checksum is the 1's complement of the byte wise exclusive or of all the bytes in the message, except the checksum itself. To validate data accuracy, all the bytes in a correctly formatted message are exclusive or'ed. If this resulting byte value is 0xFF, then the message data is accepted as good.

The opcodes may be examined to determine message length and if subsequent response message is required. Data bits d6 and d5 encode the message length. The message length includes the opcode and the checksum bytes. The bit d3 = 1 implies that a follow-on message or reply is expected.

\begin{tabular}{p{0.05\linewidth} p{0.05\linewidth}  p{0.05\linewidth}  p{0.05\linewidth}  p{0.05\linewidth}  p{0.05\linewidth}  p{0.05\linewidth}  p{0.05\linewidth} p{0.36\linewidth}} 
\underline{d7} & \underline{d6} & \underline{d5} & \underline{d4} & \underline{d3} & \underline{d2} & \underline{d1} & \underline{d0} & \\
1 & 0 & 0 & E & D & C & B & A & 2 byte message\\
1 & 0 & 1 & E & D & C & B & A & 4 byte message\\
1 & 1 & 0 & E & D & C & B & A & 6 byte message\\
1 & 1 & 1 & E & D & C & B & A & Variable length message. The next byte in the message is a 7 bit byte count.\\
\end{tabular}

The A,B,C,D,E are bits available to encode 32 opcodes per message length.

\section{Refresh Slots}
The command station standard refresh stack is an array of up to 120 read/write refresh slots. The slot address is a principal component and is generally the second byte or 1st argument of a message to the master. The standard refresh slot contains up to 10 data bytes relating to a locomotive and also controls a task in the track DCC refresh stack. Most mobile decoder or locomotive operations process the slot associated with the locomotive to be controlled. The slot number is a similar shorthand ID\# to a file handle. Slot addresses 120-127 are reserved for system and command station control. Slot \#124 (0x7C) is allocated for read/write access to the programming track, and the format is not the same as a standard slot. The DCS240 command station has 400 read/write refresh slots. The additional slots in excess of the 120 standard slots are accessed by using extended opcodes. The DCS210 also supports the extended opcodes though it only has 100 refresh slots.

\subsection{Slot Format}

\subsubsection{Standard Slot - 0 to 119}

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.375\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Slot number in the range 0x00 to 0x7F. Slot 0x00 is a special slot, and slots in the range 0x70 to 0x7F are reserved to Digitrax.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
d7 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$STAT1$>$ & Slot status 1.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.70\linewidth}} 
& \underline{d7} & \underline{d6} & \\
& 0 & 0 & Free, no consist linking.\\
& 0 & 1 & Consist sub-member.\\
& 1 & 0 & Consist top-member.\\
& 1 & 1 & Consist Mid-Consist member. \\
\end{tabular}

Note: d7 is set to 0 in the message by the command station and so may not correctly reflect the actual setting in the slot table.\\

\begin{tabular}{p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.70\linewidth}} 
& \underline{d5} & \underline{d4} & \\
& 0 & 0 & Free slot, no valid data. Not refreshed.\\
& 0 & 1 & Common. Locomotive address in this slot. Refreshed.\\
& 1 & 0 & Idle. Locomotive address in this slot. Not refreshed.\\
& 1 & 1 & In Use. Locomotive address in this slot. Refreshed. \\
\end{tabular}

 \begin{tabular}{p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.70\linewidth}} 
& & \underline{d3} & \\
& & 0 & No slot consist linked into this slot.\\
& & 1 & Slot consist linked into this slot.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.75\linewidth}} 
\underline{d2} & \underline{d1} & \underline{d0} & \\
0 & 0 & 0 & 28 step decoder. 3-byte packet regular mode\\
0 & 0 & 1 & 28 step decoder. Generate trinary packets for this mobile address\\
0 & 1 & 0 & 14 step decoder. \\
0 & 1 & 1 & 128 step decoder. \\
1 & 0 & 0 & 28 step decoder. Allow advanced consisting\\
1 & 0 & 1 & reserved\\
1 & 1 & 0 & reserved\\
1 & 1 & 1 & 128 step decoder. Allow advanced consisting\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR$>$ & Low address.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.36\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SPD$>$ & Speed in the range 0x00 to 0x7F. 0x00 means inertial stop and 0x01 means emergency stop. Other values mean increasing speed.\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.36\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$DIRF$>$ & Locomotive direction and state of functions F0 to F4.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.95\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Locomotive direction. 1 means forward, 0 means backwards.\\
d4 & F0 state. 1 means on, and 0 means off.\\
d3 & F4 state. 1 means on, and 0 means off.\\
d2 & F3 state. 1 means on, and 0 means off.\\
d1 & F2 state. 1 means on, and 0 means off.\\
d0 & F1 state. 1 means on, and 0 means off.\\
\end{tabular}

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$TRK$>$ & Global system track status.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Reserved. Set to 0.\\
d4 & Reserved. Set to 0.\\
d3 & 1 means the programming track is busy.\\
d2 & 1 means this master implements the Network version 1.1 capability,  0 means the master is a DT200.\\
d1 & 0 means the track is paused, broadcast an emergency stop.\\
d0 & 1 means the DCC packets are on in the master, global power up.\\
\end{tabular}

Byte 6:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SS2$>$ & Slot status 2.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Reserved. Set to 0.\\
d4 & Reserved. Set to 0.\\
d3 & 1 means expansion in ID1/2, 0 means encoded alias.\\
d2 & 1 means expansion ID1/2 is not ID usage.\\
d1 & Reserved. Set to 0.\\
d0 & 1 means this slot has suppressed advanced consist.\\
\end{tabular}

Byte 7:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR2$>$ & High address.\\
\end{tabular}

Byte 8:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.36\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SND$>$ & Slot sound / function mode II packets.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Reserved. Set to 0.\\
d4 & Reserved. Set to 0.\\
d3 & Sound 4 / F8.\\
d2 & Sound 3 / F7.\\
d1 & Sound 2 / F6.\\
d0 & Sound 1 / F5.\\
\end{tabular}

Byte 9:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.37\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ID1$>$ & 7-bit ls ID code written by throttle when STAT2.4 = 1.\\
\end{tabular}

Byte 10:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.37\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ID2$>$ & 7-bit ms ID code written by throttle when STAT2.4 = 1.\\
\end{tabular}

\subsubsection{Slot 0x7F}

OST1 to OST6 encode the command station's option switch table. The narrative is based upon information in the the DCS210 and DCS240 user manuals. A bit value of 1 means that the switch is closed and a value of 0 means that a switch is thrown. OpSw 8, OpSw 16, OpSw 24, OpSw 32 and OpSw 40 cannot be read due to bit 7 being cleared in the message format. The manual shows these switches as defaulting to thrown, i.e. 0, and are flagged in all cases except OpSw 40 as ``do not change".

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.376\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Slot number in the range 0x00 to 0x7F. Slot 0x00 is a special slot, and slots in the range 0x70 to 0x7F are reserved to Digitrax.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$OST1$>$ & Option switch table byte 1.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.125\linewidth} p{0.1\linewidth} p{0.625\linewidth}} 
\underline{Bit} & \underline{Switch \#} & \underline{Default} & \underline{Effect on system operation}\\
d6 & OpSw 07 & t & do not change\\
d5 & OpSw 06 & t & t = check for decoder before programming\\
& & & c = program without checking for device\\ 
d4 & OpSw 05 & t & do not change\\
d3 & OpSw 04 & t & do not change\\
d2 & OpSw 03 & t & t = command station's booster normal\\
& & & c = command station's booster is auto reversing\\
d1 & OpSw 02 & t & t = command station mode\\
& & & c = booster only mode.\\
d0 & OpSw 01 & t & do not change.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$OST2$>$ & Option switch table byte 2.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.125\linewidth} p{0.1\linewidth} p{0.625\linewidth}} 
\underline{Bit} & \underline{Switch \#} & \underline{Default} & \underline{Effect on system operation}\\
d6 & OpSw 15 & t & t = purging will not change loco speed\\
&&& c = purging will force a loco to 0 speed\\
d5 & OpSw 14 & t & t = loco address purging enabled\\
&&& c = loco address purging disabled\\
d4 & OpSw 13 & t & t = loco address purge time 200 seconds\\
& & & c = loco address purge time 600 seconds\\
d3 & OpSw 12 & t & do not change\\
d2 & OpSw 11 & t & do not change\\
d1 & OpSw 10 & c & do not change\\
d0 & OpSw 09 & c & do not change\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$OST3$>$ & Option switch table byte 3.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.125\linewidth} p{0.1\linewidth} p{0.625\linewidth}} 
\underline{Bit} & \underline{Switch \#} & \underline{Default} & \underline{Effect on system operation}\\
d6 & OpSw 23 & t & SW23\\
d5 & OpSw 22 & c & SW22\\ 
d4 & OpSw 21 & c & SW21\\
d3 & OpSw 20 & t & t = enable address 0x00 or analog stretching for conventional locos\\
&&&. c = disable address 0x00 or analog stretching for conventional locos\\
d2 & OpSw 19 & t & do not change\\
d1 & OpSw 18 & t & t = normal command station booster short circuit shutdown time\\
&&& c = extended command station booster short circuit shutdown time\\
d0 & OpSw 17 & t & t = automatic advanced decode (FX) consists are enabled\\
&&& c = automatic advanced decode (FX) consists are disabled\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.5\linewidth}} 
\underline{SW21} & \underline{SW22} & \underline{SW23} & \underline{Global system default type for new locos}\\
t & t & t & 28 step mode\\
t & t & c & reserved\\
t & c & t & 14 step mode\\
t & c & c & reserved\\
c & t & t & reserved\\
c & t & c & reserved\\
c & c & t & 128 step mode\\
c & c & c & 128 step FX mode\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$OST4$>$ & Option switch table byte 4.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.125\linewidth} p{0.1\linewidth} p{0.625\linewidth}} 
\underline{Bit} & \underline{Switch \#} & \underline{Default} & \underline{Effect on system operation}\\
d6 & OpSw 31 & t & t = normal route/switch output rate when not trinary\\
&&& c = fast route/switch output rate when not trinary\\ 
d5 & OpSw 30 & t & do not change\\ 
d4 & OpSw 29 & t & do not change\\
d3 & OpSw 28 & t & t = enable interrogate commands at power on\\
&&& c = disable interrogate commands at power on\\
d2 & OpSw 27 & t & t = enable normal switch commands, a.k.a. the ``Bushby bit"\\
&&& c = disable normal switch commands, a.k.a. the ``Bushby bit" (allows attached computer to handle switch control logic)\\
d1 & OpSw 26 & c & t = disable routes\\
&&& c = enable routes\\
d0 & OpSw 25 & t & t = enable route echo over the Network\\
&&& c = disbale route echo over the Network\\
\end{tabular}

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$TRK$>$ & Global system track status.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Reserved. Set to 0.\\
d4 & Reserved. Set to 0.\\
d3 & 1 means the programming track is busy.\\
d2 & 1 means this master implements the Network version 1.1 capability,  0 means the master is a DT200.\\
d1 & 0 means the track is paused, broadcast an emergency stop.\\
d0 & 1 means the DCC packets are on in the master, global power up.\\
\end{tabular}

Byte 6:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$OST5$>$ & Option switch table byte 5.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.125\linewidth} p{0.1\linewidth} p{0.625\linewidth}} 
\underline{Bit} & \underline{Switch \#} & \underline{Default} & \underline{Effect on system operation}\\
d6 & OpSw 39 & t & c = clear all internal memory states, including OpSw 36 and 37\\
d5 & OpSw 38 & t & t = loco reset button activates OpSw 39\\
&&& c = loco reset activates slot zero\\ 
d4 & OpSw 37 & t & c = clears all routes\\
d3 & OpSw 36 & t & c = clears all mobile decoder info and consists\\
d2 & OpSw 35 & t & t = enables loco reset buttone\\
&&& c = disable loco reset button\\
d1 & OpSw 34 & t & t = disallow track to power up to run state, if set to run prior to power up\\
&& & c = allow track to power up to run state, if set to run prior to power up\\
d0 & OpSw 33 & c & t = track power off at power on\\
&&& c = allow track power to restore to prior state at power on\\
\end{tabular}

Byte 7:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$OST6$>$ & Option switch table byte 6.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.125\linewidth} p{0.1\linewidth} p{0.625\linewidth}} 
\underline{Bit} & \underline{Switch \#} & \underline{Default} & \underline{Effect on system operation}\\
d6 & OpSw 47 & t & t = normal program track setting\\
&&& c = program track is brake generator when not programming. Braking is DCC set to speed 0 (not emergency stop) for address 0, light on, broadcast to all addresses.\\
d5 & OpSw 46 & t & do not change\\ 
d4 & OpSw 45 & t & t = enable reply for switch state request\\
&&& c = disable reply for switch state request\\
d3 & OpSw 44 & t & do not change\\
d2 & OpSw 43 & t & t = enable the Network update of command station's track status\\
&&& c = disable the Network update of command station's track status\\
d1 & OpSw 42 & t & t = enable 2 short beeps when loco address purged\\
&&& c = disable 2 short beeps when loco address purged\\
d0 & OpSw 41 & t & t = diagnostic click disabled\\
&&& c = diagnostic click when valid the Network commands incoming and routes being output\\
\end{tabular}

Byte 8:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 9:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CSM$>$ & Command station model.\\
\end{tabular}

\begin{tabular}{p{0.1\linewidth} p{0.6\linewidth}} 
\underline{CSM} & \underline{Model}\\
0x1B & DCS210\\
0x1C & DCS240\\
\end{tabular}

Byte 10:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

\subsection{Extended Slot Format}

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & 0 & 0 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SLOTP\#$>$ & Extended slot page number in the range 0x0 to 0x7.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOTL\#$>$ & Extended slot number in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  $<$STAT1$>$ & Slot status 1.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.70\linewidth}} 
& \underline{d5} & \underline{d4} & \\
& 0 & 0 & Free slot, no valid data. Not refreshed.\\
& 0 & 1 & Common. Locomotive address in this slot. Refreshed.\\
& 1 & 0 & Idle. Locomotive address in this slot. Not refreshed.\\
& 1 & 1 & In Use. Locomotive address in this slot. Refreshed. \\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR$>$ & Low address.\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR2$>$ & High address.\\
\end{tabular}

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$TRK$>$ & Global system track status.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Reserved. Set to 0.\\
d4 & Reserved. Set to 0.\\
d3 & 1 means the programming track is busy.\\
d2 & 1 means this master implements the Network version 1.1 capability,  0 means the master is a DT200.\\
d1 & 0 means the track is paused, broadcast an emergency stop.\\
d0 & 1 means the DCC packets are on in the master, global power up.\\
\end{tabular}

Byte 6:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 7:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 8:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 9:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 10:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 11:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 12:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 13:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 14:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 15:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 16:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

Byte 17:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Unknown.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & \\
d5 & \\
d4 & \\
d3 & \\
d2 & \\
d1 & \\
d0 & \\
\end{tabular}

\section{Standard Address Selection}

To request a mobile or locomotive decoder task in the refresh stack, a throttle device requests a locomotive address for use (OPC\_LOCO\_ADR). The command station responds with a slot data read for the slot (OPC\_SL\_RD\_DATA), that contains this locomotive address and all of its state information. If the address is currently not in any slot, the command station will load this new locomotive address into a new slot (speed=0, direction forwards, functions off and 128 step mode) and return this as a OPC\_SL\_RD\_DATA. If no inactive slots are free to load the new locomotive address, the response will be the OPC\_LONG\_ACK with a fail code 0x00.

The throttle/computer must then examine the slot data bytes to work out how to process the command station response. If the slot status 1 byte shows the slot to be common idle or new the throttle may change the slot to in use by performing a null move instruction (see OPC\_MOVE\_SLOTS) on this slot. This activation mechanism is used to guarantee proper slot usage interlocking in a multi-user asynchronous environment.

If the slot return information shows the locomotive requested is in use or up-consisted (i.e. the SL\_CONUP, bit 6 of slot status 1 = 1) the user should not use the slot. Any up-consisted locomotives must be unlinked before usage. Always process the result from the OPC\_LINK\_SLOTS and OPC\_UNLINK\_SLOTS commands, since the command station reserves the right to change the reply slot number and can reject the linking tasks under several circumstances. Verify the reply slot number and the link UP/DN bits in slot status 1 are as you expected.

The throttle will then be able to update speed, direction and function information. Whenever slot information is changed in an active slot , the slot is flagged to be updated as the next DCC packet sent to the track. If the slot is part of linked consist slots the whole consist chain is updated consecutively.

If a throttle is disconnected from the the Network, upon reconnection (if the throttle retains the slot state from before disconnection) it will request the full status of the slot it was previously using. If the reported status and speed, function data etc., from the command station exactly matches the remembered slot state the throttle will continue using the slot. If the slot data does not match, the throttle will assume the slot was purged free by the system and will go through the setup log on procedure again.

With this procedure the throttle does not need to have a unique ID number. slot addresses do not imply they contain any particular locomotive address. The system can be mapped such that the slot address matches the locomotive address within, if the user directly reads and writes to slots without using the command station to allocate locomotive addresses.

\section{Opcodes}

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_BRD\_OPSW}
\underline{Operation:} Read and write board option switches.

\underline{Group:} \hspace{0.5cm} 6-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 0 & 1 & 0 & 0 & 0 & 0\\
\hline
\end{tabular}
& 0xD0 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & 1 & d4 & 0 & 0 & 1 & d0\\
\hline
\end{tabular}
&  & The bit d0 is the most significant bit of the board id. Bit d4 indicates read/write direction. 1 means write and 0 means read.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$BIDL$>$ & Least significant 7 bits of the board id.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$BTYPE$>$ & Board type code.\\
\end{tabular}

\begin{tabular}{p{0.2\linewidth} p{0.5\linewidth}} 
\underline{Board} & \underline{Type Code}\\
PM4 & 0x70.\\
BDL16 & 0x71.\\
SE8C & 0x72.\\
DS64 & 0x73.\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
&  & Byte and bit number. The high nibble encodes the byte number, and the low nibble the bit number.\\
\end{tabular}

The byte number is calculated as (OpSw\# - 1) $>>$ 3 and the bit number is (OpSw\# - 1) - byte number $\times$ 8.

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

\underline{Response:} 

OPC\_LONG\_ACK.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_BUSY}
\underline{Operation:} Indicates that the master is busy.

\underline{Group:} \hspace{0.5cm} 2-Byte Message

\underline{Direction:} \hspace{0.05cm} $\leftrightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 0 & 0 & 0 & 0 & 0 & 1\\
\hline
\end{tabular}
& 0x81 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & 1 & 1 & 1 & 1 & 1 & 0\\
\hline
\end{tabular}
& 0x7E & Checksum.
\end{tabular}

\underline{Description:}

This message indicates that the master is busy. When sent to a command station it responds with an OPC\_PEER\_XFER message.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_CONSIST\_FUNC}
\underline{Operation:} Set function bits in a consist uplink element.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 0 & 1 & 1 & 0\\
\hline
\end{tabular}
& 0xB6 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Slot number in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$DIRF$>$ & Consist element's direction and state of functions F0 to F4.\\
& \\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.95\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Locomotive direction. 1 means forward, 0 means backwards.\\
d4 & F0 state. 1 means on, and 0 means off.\\
d3 & F4 state. 1 means on, and 0 means off.\\
d2 & F3 state. 1 means on, and 0 means off.\\
d1 & F2 state. 1 means on, and 0 means off.\\
d0 & F1 state. 1 means on, and 0 means off.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

This function sets the consist element's direction and function F0 to F4 states.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_GPOFF}
\underline{Operation:} Global power off request.

\underline{Group:} \hspace{0.5cm} 2-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 0 & 0 & 0 & 0 & 1 & 0\\
\hline
\end{tabular}
& 0x82 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & 1 & 1 & 1 & 1 & 0 & 1\\
\hline
\end{tabular}
& 0x7D & Checksum.
\end{tabular}

\underline{Description:}

This command turns off the track power.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_GPON}
\underline{Operation:} Global power on request.

\underline{Group:} \hspace{0.5cm} 2-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 0 & 0 & 0 & 0 & 1 & 1\\
\hline
\end{tabular}
& 0x83 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & 1 & 1 & 1 & 1 & 0 & 0\\
\hline
\end{tabular}
& 0x7C & Checksum.
\end{tabular}

\underline{Description:}

This command sends a global power on request.

\underline{Response:} 

The on power on the command station sends an OPC\_RQ\_SL\_DATA message for slot 0x7F. It also sends a sequence of OPC\_SW\_REQ messages with the following values of SW1 and SW2:

\begin{tabular}{l l l}
\underline{SW1} & \underline{SW2} & \underline{Purpose}\\
0x78 & 0x27\\
0x79 & 0x27\\
0x7A & 0x27\\
0x7B & 0x27\\
0x78 & 0x07 & Interrogate all PM4 inputs?\\
0x79 & 0x07 & Interrogate all BDL16 input reports?\\
0x7A & 0x07 & Interrogate all SE8 input reports?\\
0x7B & 0x07 & Interrogate all DS64 input reports.\\
\end{tabular}

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_IDLE}
\underline{Operation:} Force idle state and broadcast emergency stop.

\underline{Group:} \hspace{0.5cm} 2-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 0 & 0 & 0 & 1 & 0 & 1\\
\hline
\end{tabular}
& 0x85 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & 1 & 1 & 1 & 0 & 1 & 0\\
\hline
\end{tabular}
& 0x7A & Checksum.
\end{tabular}

\underline{Description:}

This command forces the Network into the idle state and broadcasts an emergency stop.

\underline{Response:} 

None

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_IMM\_PACKET}
\underline{Operation:} Send n-byte packet immediate.

\underline{Group:} \hspace{0.5cm} Variable-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ command station  

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 1 & 0 & 1 & 1 & 0 & 1\\
\hline
\end{tabular}
& 0xED & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & 1 & 0 & 0 & 0 & 0\\
\hline
\end{tabular}
& 0x0B & Message length (11 bytes).\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & 1 & 1 & 1 & 1 & 1 & 1\\
\hline
\end{tabular}
& 0x7F & Source id in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$REPS$>$ & Number of immediate bytes and repeat count.
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & N2. Number of immediate bytes.\\
d5 & N1. Number of immediate bytes.\\
d4 & N0. Number of immediate bytes.\\
d3 & A4. Reserved. Set to 0.\\
d2 & R2. Repeat count.\\
d1 & R1. Repeat count.\\
d0 & R0. Repeat count.\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 1 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$DHII$>$ & High bits of IM1 to IM5.
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d4 & IM5.7. High bit.\\
d3 & IM4.7. High bit.\\
d2 & IM3.7. High bit.\\
d1 & IM2.7. High bit.\\
d0 & IM1.7. High bit.\\
\end{tabular}

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$IM1$>$ & Data item 1 low 7 bits.
\end{tabular}

Byte 6:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$IM2$>$ & Data item 2 low 7 bits.
\end{tabular}

Byte 7:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$IM3$>$ & Data item 3 low 7 bits.
\end{tabular}

Byte 8:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$IM4$>$ & Data item 4 low 7 bits.
\end{tabular}

Byte 9:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$IM5$>$ & Data item 5 low 7 bits.
\end{tabular}

Byte 10:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

Send n-byte packet immediate.

\underline{Response:} 

OPC\_LONG\_ACK.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_INPUT\_REP}
\underline{Operation:} General sensor input report.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} General sensor $\rightarrow$ 

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 0 & 0 & 1 & 0\\
\hline
\end{tabular}
& 0xB2 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$IN1$>$ & Sensor address A7 to A1.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & A7.\\
d5 & A6.\\
d4 & A5.\\
d3 & A4.\\
d2 & A3.\\
d1 & A2.\\
d0 & A1.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$IN2$>$ & Switch address A11 to A8 and sensor input state.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d5 & A0.\\
d4 & Input state. 1 means sensor input $>=$ 6V, and 0 means sensor input = 0V.\\
d3 & A11.\\
d2 & A10.\\
d1 & A9.\\
d0 & A8.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

General sensor report.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LINK\_SLOTS}
\underline{Operation:} Link slots.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 1 & 0 & 0 & 1\\
\hline
\end{tabular}
& 0xB9 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SL1$>$ & Slot number in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SL2$>$ & Slot number in the range 0x00 to 0x7F.\\
& \\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

This function links slot SL1 to slot SL2. The command station setsSL\_CONUP/DN flags appropriately. Invalid link will return a fail acknowledgement.

\underline{Response:} 

OPC\_SL\_RD\_DATA or OPC\_LONG\_ACK.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LOCO\_ADR}
\underline{Operation:} Request a slot number for a locomotive.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 1 & 1 & 1 & 1\\
\hline
\end{tabular}
& 0xBF & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR2$>$ & High address.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR$>$ & Low address.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

This message requests the slot number for the selected locomotive address. If the locomotive is found in the slot table then the command station returns an OPC\_SL\_RD\_DATA message with the slot information. If it is not found then the command station will put the locomotive into a free slot and then return an OPC\_SL\_RD\_DATA message with the slot information. If there are no free slots then the command station returns an OPC\_LONG\_ACK error code.

Note that regular short 7 bit NMRA addresses are denoted by $<$ADR2$>$ = 0. The Analog, zero stretched, locomotive is selected when both $<$ADR2$>$ = 0 and $<$ADR$>$ = 0. $<$ADR$>$ is always a 7 bit value. If $<$ADR2$>$ is non-zero then the master will generate NMRA type 14 bit or long address packets using all 14 bits from $<$ADR2$>$ and $<$ADR$>$ with $<$ADR2$>$ being the most significant address bits. Note that a DT200 Master does not process 14 bit address requests and will consider the $<$ADR2$>$ to be zero. You can check the $<$TRK$>$ return bits to see if the master is a DT200.

\underline{Response:} 

OPC\_SL\_RD\_DATA if success, otherwise OPC\_LONG\_ACK.

\underline{Notes:} 

The the Network 1.1 specification specifies that $<$ADR2$>$ value is 0x00.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LOCO\_ADR\_EXT}
\underline{Operation:} Request an extended slot for a locomotive.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 1 & 1 & 1 & 0\\
\hline
\end{tabular}
& 0xBE & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR2$>$ & High address.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR$>$ & Low address.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

This message requests the slot number for the selected locomotive address. If the locomotive is found in the slot table then the command station returns an OPC\_SL\_RD\_DATA\_EXT message with the slot information. If it is not found then the command station will put the locomotive into a free slot and then return an OPC\_SL\_RD\_DATA\_EXT message with the slot information. If there are no free slots then the command station returns an OPC\_LONG\_ACK error code.

Note that regular short 7 bit NMRA addresses are denoted by $<$ADR2$>$ = 0. The Analog, zero stretched, locomotive is selected when both $<$ADR2$>$ = 0 and $<$ADR$>$ = 0. $<$ADR$>$ is always a 7 bit value. If $<$ADR2$>$ is non-zero then the master will generate NMRA type 14 bit or long address packets using all 14 bits from $<$ADR2$>$ and $<$ADR$>$ with $<$ADR2$>$ being the most significant address bits. Note that a DT200 Master does not process 14 bit address requests and will consider the $<$ADR2$>$ to be zero. You can check the $<$TRK$>$ return bits to see if the master is a DT200.

\underline{Response:} 

OPC\_SL\_RD\_DATA\_EXT if success, otherwise OPC\_LONG\_ACK.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LOCO\_DIRF}
\underline{Operation:} Set locomotive direction and function F0 to F4 states.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 0 & 0 & 0 & 0 & 1\\
\hline
\end{tabular}
& 0xA1 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Slot number in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$DIRF$>$ & Locomotive's direction and state of functions F0 to F4.\\
& \\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.95\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Locomotive direction. 1 means forward, 0 means backwards.\\
d4 & F0 state. 1 means on, and 0 means off.\\
d3 & F4 state. 1 means on, and 0 means off.\\
d2 & F3 state. 1 means on, and 0 means off.\\
d1 & F2 state. 1 means on, and 0 means off.\\
d0 & F1 state. 1 means on, and 0 means off.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

This function sets the locomotive's direction and function F0 to F4 states.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LOCO\_DIRF\_EXT}
\underline{Operation:} Set locomotive direction and function F0 to F28 states for extended slots.

\underline{Group:} \hspace{0.5cm} 6-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 0 & 1 & 0 & 1 & 0 & 0\\
\hline
\end{tabular}
& 0xD4 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 1 & 0 & 0 & d2 & d1 & d0\\
\hline
\end{tabular}
& 0x2$<$SLOTP$>$ & Bits d2 to d0 contain the extended slot page number in the range 0x0 to 0x7.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Extended slot number.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & 0 & 0 & 1 & 0 & 0\\
\hline
\end{tabular}
& $<$SUBC$>$ & Subcode.\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$DIRFX$>$ & Direction and function sates.\\
\end{tabular}

\begin{tabular}{p{0.1\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth} p{0.05\linewidth}} 
\underline{SUBC} & \underline{d6} & \underline{d5} & \underline{d4} & \underline{d3} & \underline{d2} & \underline{d1} & \underline{d0} \\ 
0x05 & 0 & 0 & 0 & 0 & F28 & F20 & F12\\
0x06 & 0 & DIR & F0 & F4 & F3 & F2 & F1\\ 
0x07 & F11 & F10 & F9 & F8 & F7 & F6 & F5\\
0x08 & F19 & F18 & F17 & F16 & F15 & F14 & F13\\
0x09 & F27 & F26 & F25 & F24 & F23 & F22 & F21\\
\end{tabular}

For the direction bit (DIR) 1 means forwards and 0 means backwards. For the function bits 1 means on and 0 means off.

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

This function sets the locomotive's direction and function F0 to F28 states.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LOCO\_FN\_EXT}
\underline{Operation:} Set locomotive function states for extended slots.

\underline{Group:} \hspace{0.5cm} 6-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 0 & 1 & 0 & 1 & 0 & 0\\
\hline
\end{tabular}
& 0xD4 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SLOTP$>$ & Bits d2 to d0 contain the extended slot page number in the range 0x0 to 0x7. The bit d4 contains the function state where 1 means on and 0 means off. The bit d3 contains the high bit of the function number (bit 14).\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Extended slot number.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$FN0$>$ & Function number bits 0 to 6.\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$FN1$>$ & Function number bits 7 to 13.\\
\end{tabular}

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

This function sets the locomotive's function F0 to F32767 states.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LOCO\_RESET}
\underline{Operation:} Loco reset button has been pressed on the command station.

\underline{Group:} \hspace{0.5cm} 2-Byte Message

\underline{Direction:} \hspace{0.05cm} Command Station $\rightarrow$ 

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 0 & 0 & 1 & 0 & 1 & 0\\
\hline
\end{tabular}
& 0x8A & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & 1 & 1 & 0 & 1 & 0 & 1\\
\hline
\end{tabular}
& 0x75 & Checksum.
\end{tabular}

\underline{Description:}

The Loco reset button has been pressed.

\underline{Response:} 

None, this is a response.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LOCO\_SND}
\underline{Operation:} Set locomotive sound functions.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 0 & 0 & 0 & 1 & 0\\
\hline
\end{tabular}
& 0xA2 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Slot number in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SND$>$ & Locomotive's function F5 to F8 states.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Reserved. Set to 0.\\
d4 & Reserved. Set to 0.\\
d3 & Reserved. Set to 0.\\
d3 & Sound 4 / F8.\\
d2 & Sound 3 / F7.\\
d1 & Sound 2 / F6.\\
d0 & Sound 1 / F5.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

This function sets the locomotive's function F5 to F8 states.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LOCO\_SPD}
\underline{Operation:} Set locomotive speed.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 0 & 0 & 0 & 0 & 0\\
\hline
\end{tabular}
& 0xA0 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Slot number in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SPD$>$ & Locomotive speed in the range 0x00 to 0x7F. 0x00 means inertial stop and 0x01 means emergency stop. Other values mean increasing speed.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

This function sets the locomotive's speed.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LOCO\_SPD\_EXT}
\underline{Operation:} Set locomotive speed for extended slots.

\underline{Group:} \hspace{0.5cm} 6-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 0 & 1 & 0 & 1 & 0 & 0\\
\hline
\end{tabular}
& 0xD4 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 1 & 0 & 0 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SLOTP$>$ & Bits d2 to d0 contain the extended slot page number in the range 0x0 to 0x7.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Extended slot number.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & 0 & 0 & 1 & 0 & 0\\
\hline
\end{tabular}
& 0x04 & Subcode.\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SPD$>$ & Locomotive speed in the range 0x00 to 0x7F. 0x00 means inertial stop and 0x01 means emergency stop. Other values mean increasing speed.\\
\end{tabular}

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

This function sets the locomotive's speed.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_LONG\_ACK}
\underline{Operation:} Long acknowledge.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 0 & 1 & 0 & 0\\
\hline
\end{tabular}
& 0xB4 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$LOPC$>$ & Opcode that this message is a response to with the most significant bit set to 0.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ACK1$>$ & Response code.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

This message provides a response code from a command.

\underline{Response:} 

None, it is the response.

\underline{Notes:} 

\begin{tabular}{p{0.3\linewidth} p{0.10\linewidth} p{0.10\linewidth} p{0.40\linewidth}}
\underline{Responding Opcode} & \underline{$<$LOPC$>$} & \underline{$<$ACK1$>$} & \underline{Meaning}\\
OPC\_SW\_ACK & 0x3D & 0x00 & DCS100 FIFO is full, command rejected.\\
OPC\_SW\_ACK & 0x3D & 0x7F &  DCS100 command accepted.\\
OPC\_MOVE\_SLOTS & 0x3A & 0x00 & Illegal move.\\
OPC\_LINK\_SLOTS & 0x39 & 0x00 & Invalid link, link failed.\\
OPC\_SW\_REQ & 0x30 & 0x00 & Command failed.\\
OPC\_LOCO\_ADR & 0x3F & 0x00 & No free slot, command failed.\\
OPC\_IMM\_PACKET & 0x7D & 0x7F & Command OK, if not limited master.\\
OPC\_IMM\_PACKET & 0x7E & $<$lim address$>$ & Command OK, if limited master.\\
OPC\_IMM\_PACKET & 0x7D & 0x00 & Internal buffer busy or full.\\
OPC\_WR\_SL\_DATA\_EXT & 0x6E & 0x7F & Command OK.\\
\end{tabular}

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_MOVE\_SLOTS}
\underline{Operation:} Move slot.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Switch

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 1 & 0 & 1 & 0\\
\hline
\end{tabular}
& 0xBA & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SRC$>$ & Source slot number in the range 0x00 to 0x77.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$DEST$>$ & Destination slot number in the range 0x00 to 0x77.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

Move slots.

\begin{tabular}{p{0.2\linewidth} p{0.2\linewidth} p{0.53\linewidth}} 
\underline{SRC} & \underline{DEST} & \underline{Action}\\
0x00 & Don't Care & Dispatch get. Return slot read of dispatch slot.\\
SRC & SRC & Null move. SRC is set to in use.\\
SRC & 0x00 & Dispatch put. Mark slot as dispatch.\\
SRC & DEST & Move slot data from SRC to DEST if not in use. Clear SRC.\\
\end{tabular}

\underline{Response:} 

OPC\_SL\_RD\_DATA or OPC\_LONG\_ACK.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_MOVE\_SLOTS\_EXT}
\underline{Operation:} Move extended slots.

\underline{Group:} \hspace{0.5cm} 6-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 0 & 1 & 0 & 1 & 0 & 0\\
\hline
\end{tabular}
& 0xD4 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 1 & 1 & 1 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SRCP$>$ & Bits d2 to d0 contain the extended source slot page number in the range 0x0 to 0x7. The higher bits are a sub-code for this operation.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SRC$>$ & Extended source slot number. In the range 0x00 to 0x7F\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & 0 & 0 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$DESTP$>$ & Bits d2 to d0 contain the extended destination slot page number in the range 0x0 to 0x7. \\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$DEST$>$ & Extended destination slot number. In the range 0x00 to 0x7F.\\
\end{tabular}

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

Move slots.

\begin{tabular}{p{0.2\linewidth} p{0.2\linewidth} p{0.53\linewidth}} 
\underline{SRC} & \underline{DEST} & \underline{Action}\\
0x00 & Don't Care & Dispatch get. Return slot read of dispatch slot.\\
SRC & SRC & Null move. SRC is set to in use.\\
SRC & 0x00 & Dispatch put. Mark slot as dispatch.\\
SRC & DEST & Move slot data from SRC to DEST if not in use. Clear SRC.\\
\end{tabular}

\underline{Response:} 

OPC\_SL\_RD\_DATA\_EXT or OPC\_LONG\_ACK.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_PEER\_XFER}
\underline{Operation:} Move 8 bytes peer to peer.

\underline{Group:} \hspace{0.5cm} Variable-Byte Message

\underline{Direction:} \hspace{0.05cm} device $\rightarrow$ device  

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 1 & 0 & 0 & 1 & 0 & 1\\
\hline
\end{tabular}
& 0xE5 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & 1 & 0 & 0 & 0 & 0\\
\hline
\end{tabular}
& 0x10 & Message length (16 bytes).\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SRC$>$ & Source id in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$DSTL$>$ & Destination id low in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$DSTH$>$ & Destination id high in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$PXCT1$>$ & Address type code and high bits of D1 to D4.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & XC2. Address type code.\\
d5 & XC1. Address type code.\\
d4 & XC0. Address type code.\\
d3 & D4.7. High bit\\
d2 & D3.7. High bit\\
d1 & D2.7. High bit\\
d0 & D1.7. High bit\\
\end{tabular}

\begin{tabular}{p{0.1\linewidth} p{0.1\linewidth} p{0.1\linewidth} p{0.4\linewidth}} 
\underline{XC2} & \underline{XC1} & \underline{XC0} & \underline{Meaning}\\
0 & 0 & 0 & 7 bit peer to peer addresses.\\
0 & 0 & 1 & reserved.\\
0 & 1 & 0 & reserved.\\
0 & 1 & 1 & reserved.\\
1 & 0 & 0 & reserved.\\
1 & 0 & 1 & reserved.\\
1 & 1 & 0 & reserved.\\
1 & 1 & 1 & reserved.\\
\end{tabular}

Byte 6:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$D1$>$ & Data item 1. Low 7 bits.\\
\end{tabular}

Byte 7:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$D2$>$ & Data item 2. Low 7 bits.\\
\end{tabular}

Byte 8:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$D3$>$ & Data item 3. Low 7 bits.\\
\end{tabular}

Byte 9:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$D4$>$ & Data item 4. Low 7 bits.\\
\end{tabular}

Byte 10:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$PXCT2$>$ & Data type code and high bits for D5 to D8.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & XC5. Data type code.\\
d5 & XC4. Data type code.\\
d4 & XC3. Data type code.\\
d3 & D8.7. High bit\\
d2 & D7.7. High bit\\
d1 & D6.7. High bit\\
d0 & D5.7. High bit\\
\end{tabular}

\begin{tabular}{p{0.1\linewidth} p{0.1\linewidth} p{0.1\linewidth} p{0.4\linewidth}} 
\underline{XC5} & \underline{XC4} & \underline{XC3} & \underline{Meaning}\\
0 & 0 & 0 & ANSI text string.\\
0 & 0 & 1 & reserved.\\
0 & 1 & 0 & reserved.\\
0 & 1 & 1 & reserved.\\
1 & 0 & 0 & reserved.\\
1 & 0 & 1 & reserved.\\
1 & 1 & 0 & reserved.\\
1 & 1 & 1 & reserved.\\
\end{tabular}

Byte 11:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$D5$>$ & Data item 5. Low 7 bits.\\
\end{tabular}

Byte 12:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$D6$>$ & Data item 6. Low 7 bits.\\
\end{tabular}

Byte 13:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$D7$>$ & Data item 7. Low 7 bits.\\
\end{tabular}

Byte 14:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$D8$>$ & Data item 8. Low 7 bits.\\
\end{tabular}

Byte 15:

\begin{tabular}{p{0.4\linewidth} p{0.1\linewidth} p{0.5\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.\\
\end{tabular}

\underline{Description:}

This command sends the data from one device to another peer to peer.

\begin{tabular}{p{0.2\linewidth} p{0.1\linewidth} p{0.1\linewidth} p{0.50\linewidth}} 
\underline{SRC} & \underline{DSTL} & \underline{DSTH} & Comments\\
0x00 & & & Source is command station.\\
Don't Care & 0x00 & 0x00 & Broadcast Message.\\
0x70 to 0x7E & & & Reserved.\\
0x7F & 0x00 & 0x00 & Broadcast throttle message transfer.\\
0x7F & ID1 & ID2 & Throttle message transfer. ID1 and ID2 encode ID.\\
\end{tabular}

\underline{Response:} 

None

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_RQ\_SL\_DATA}
\underline{Operation:} Request slot data or status block.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Switch

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 1 & 0 & 1 & 1\\
\hline
\end{tabular}
& 0xBB & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Slot number in the range 0x00 to 0x7F. 0 returns the command station status block\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & 0 & 0 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SLOTP$>$ & Bits d2 to d0 contain the extended slot page number in the range 0x0 to 0x7. The bit d3 does something but its function is not yet known. When bit d6 is 1 then extended slot data is returned for all slots, when it is 0 standard slot data is returned for slots 0x00 to 0x7F.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

Request slot data or status block.

\underline{Response:} 

if SLOTP = 0x00 then OPC\_SL\_RD\_DATA, otherwise OPC\_SL\_RD\_DATA\_EXT.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_SL\_RD\_DATA}
\underline{Operation:} Returns slot data.

\underline{Group:} \hspace{0.5cm} Variable-Byte Message

\underline{Direction:} \hspace{0.05cm} Command Station $\rightarrow$ 

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 1 & 0 & 0 & 1 & 1 & 1\\
\hline
\end{tabular}
& 0xE7 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & 1 & 1 & 1 & 1 & 1 & 0\\
\hline
\end{tabular}
& 0x0E & Message length (14 bytes).\\
\end{tabular}

Bytes 2 to 12 encode as per slot bytes 0 to 10.

Byte 13:

\begin{tabular}{p{0.4\linewidth} p{0.1\linewidth} p{0.5\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.\\
\end{tabular}

\underline{Description:}

This message is sent by the command station in response to a slot data request.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_SL\_RD\_DATA\_EXT}
\underline{Operation:} Returns extended slot data.

\underline{Group:} \hspace{0.5cm} Variable-Byte Message

\underline{Direction:} \hspace{0.05cm} Command Station $\rightarrow$ 

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 1 & 0 & 0 & 1 & 1 & 0\\
\hline
\end{tabular}
& 0xE6 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & 1 & 0 & 1 & 0 & 1\\
\hline
\end{tabular}
& 0x15 & Message length (21 bytes).\\
\end{tabular}

Bytes 2 to 19 encode as per extended slot bytes 0 to 17.

Byte 20:

\begin{tabular}{p{0.4\linewidth} p{0.1\linewidth} p{0.5\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.\\
\end{tabular}

\underline{Description:}

This message is sent by the command station in response to an extended slot data request.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_SLOT\_STAT1}
\underline{Operation:} Set slot status 1.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 0 & 1 & 0 & 1\\
\hline
\end{tabular}
& 0xB5 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SLOT\#$>$ & Slot number in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$STAT1$>$ & Slot status 1.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

This function sets the slot's status 1 values.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_SW\_ACK}
\underline{Operation:} Request switch command with acknowledge.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Turnout controller

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 1 & 1 & 0 & 1\\
\hline
\end{tabular}
& 0xBD & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SW1$>$ & Switch address A6 to A0.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & A6.\\
d5 & A5.\\
d4 & A4.\\
d3 & A3.\\
d2 & A2.\\
d1 & A1.\\
d0 & A0.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SW2$>$ & Switch address A10 to A7 and switch control bits.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Direction. 1 means closed/green, and 0 means thrown/red.\\
d4 & Output. 1 means on, and 0 means off.\\
d3 & A10.\\
d2 & A9.\\
d1 & A8.\\
d0 & A7.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

Command a turnout controller to a specified state and send acknowledge.

\underline{Response:} 

OPC\_LONG\_ACK.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_SW\_REP}
\underline{Operation:} Turnout sensor report.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} Turnout sensor $\rightarrow$ 

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 0 & 0 & 0 & 1\\
\hline
\end{tabular}
& 0xB1 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SN1$>$ & Sensor address.\\
\end{tabular}

\begin{tabular}{p{0.5\linewidth} p{0.5\linewidth}}
\underline{SN2.d6 = 1} & \underline{SN2.d6 = 0}\\
\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & A7.\\
d5 & A6.\\
d4 & A5.\\
d3 & A4.\\
d2 & A3.\\
d1 & A2.\\
d0 & A1.\\
\end{tabular} &
\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & A6.\\
d5 & A5.\\
d4 & A4.\\
d3 & A3.\\
d2 & A2.\\
d1 & A1.\\
d0 & A0.\\
\end{tabular} \\

\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SN2$>$ & Sensor address and sensor state.\\
\end{tabular}

\begin{tabular}{p{0.555\linewidth} p{0.555\linewidth}}

\underline{SN2.d6 = 1} & \underline{SN2.d6 = 0}\\
\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Report type. 1 means the report is an input report, and 0 means the report is an output report.\\
d5 & A0.\\
d4 & Input sensor state, 1 means sensor $>=$ 6V, 0 means sensor = 0V.\\
d3 & A11.\\
d2 & A10.\\
d1 & A9.\\
d0 & A8.\\
\end{tabular} &
\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Report type. 1 means the report is an input report, and 0 means the report is an output report.\\
d5 & 0 means closed output line is off, 1 means the closed output line is on.\\
d4 & 0 means thrown output line is off, 1 means the thrown output line is on.\\
d3 & A10.\\
d2 & A9.\\
d1 & A8.\\
d0 & A7.\\
\end{tabular} \\

\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

Turnout sensor report.

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_SW\_REQ}
\underline{Operation:} Request switch command.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Turnout controller

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 0 & 0 & 0 & 0\\
\hline
\end{tabular}
& 0xB0 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SW1$>$ & Switch address A6 to A0.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & A6.\\
d5 & A5.\\
d4 & A4.\\
d3 & A3.\\
d2 & A2.\\
d1 & A1.\\
d0 & A0.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SW2$>$ & Switch address A10 to A7 and switch control bits.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.6\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Direction. 1 means closed/green, and 0 means thrown/red.\\
d4 & Output. 1 means on, and 0 means off.\\
d3 & A10.\\
d2 & A9.\\
d1 & A8.\\
d0 & A7.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

Command a turnout controller to a specified state.

\underline{Response:} 

OPC\_LONG\_ACK if command failed, otherwise no response.

\underline{Notes:} 

The on power on the command station sends a sequence of OPC\_SW\_REQ messages with the following values of SW1 and SW2:

\begin{tabular}{l l l}
\underline{SW1} & \underline{SW2} & \underline{Purpose}\\
0x78 & 0x27\\
0x79 & 0x27\\
0x7A & 0x27\\
0x7B & 0x27\\
0x78 & 0x07 & Interrogate all PM4 inputs?\\
0x79 & 0x07 & Interrogate all BDL16 input reports?\\
0x7A & 0x07 & Interrogate all SE8 input reports?\\
0x7B & 0x07 & Interrogate all DS64 input reports.\\
\end{tabular}

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_SW\_STATE}
\underline{Operation:} Request state of switch.

\underline{Group:} \hspace{0.5cm} 4-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Switch

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 1 & 1 & 0 & 0\\
\hline
\end{tabular}
& 0xBC & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SW1$>$ & Switch address A6 to A0.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & d6 & d5 & d4 & d3 & d2 & d1 & d0\\
\hline
\end{tabular}
& $<$SW2$>$ & Switch address A10 to A7 and switch control bits.\\
\end{tabular}

\begin{tabular}{p{0.05\linewidth} p{0.8\linewidth}} 
d6 & Reserved. Set to 0.\\
d5 & Direction. 1 means closed/green, and 0 means thrown/red.\\
d4 & Output. 1 means on, and 0 means off.\\
d3 & A10.\\
d2 & A9.\\
d1 & A8.\\
d0 & A7.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.

\end{tabular}

\underline{Description:}

Request state of switch.

\underline{Response:} 

OPC\_LONG\_ACK.

\underline{Notes:} 

This needs to be tested to see what the real purpose is.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_TRANS\_REP}
\underline{Operation:} Transponder input report.

\underline{Group:} \hspace{0.5cm} 6-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 0 & 1 & 0 & 0 & 0 & 0\\
\hline
\end{tabular}
& 0xD0 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
&  & A value of 0x20 means the positive detection of a transponder, 0x00 means no longer detected.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & 0 & n & n & n & n\\
\hline
\end{tabular}
& $<$ZONE\#$>$ & Zone indicator (0x0 = A, 0x2 = B, 0x4 = C, 0x6 = D).\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR$>$ & Locomotive address low bits.\\
\end{tabular}

Byte 4:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$ADR2$>$ & Locomotive address high bits.\\
\end{tabular}

Byte 5:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.
\end{tabular}

\underline{Description:}

\underline{Response:} 

None.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_UNLINK\_SLOTS}
\underline{Operation:} Unlink slots.

\underline{Group:} \hspace{0.5cm} Variable-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station  

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 0 & 1 & 1 & 1 & 0 & 0 & 0\\
\hline
\end{tabular}
& 0xB8 & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SL1$>$ & Slot number in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 2:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$SL2$>$ & Slot number in the range 0x00 to 0x7F.\\
\end{tabular}

Byte 3:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.\\
\end{tabular}

\underline{Description:}

This command unlinks slot SL1 from slot SL2.

\underline{Response:} 

Returns OPC\_SL\_RD\_DATA or OPC\_LONG\_ACK.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_WR\_SL\_DATA}
\underline{Operation:} Write slot data.

\underline{Group:} \hspace{0.5cm} Variable-Byte Message

\underline{Direction:} \hspace{0.05cm} $\rightarrow$ Command Station  

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 1 & 0 & 1 & 1 & 1 & 1\\
\hline
\end{tabular}
& 0xEF & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 1 & 1 & 1 & 1 & 1 & 1 & 0\\
\hline
\end{tabular}
& 0x0E & Message length (14 bytes).\\
\end{tabular}

Bytes 2 to 12 encode as per slot bytes 0 to 10.

Byte 13:

\begin{tabular}{p{0.4\linewidth} p{0.1\linewidth} p{0.5\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.\\
\end{tabular}

\underline{Description:}

This command sends the slot data to the command station.

\underline{Response:} 

Returns OPC\_LONG\_ACK.

\underline{Notes:} 

None.

\rule{15.1cm}{0.4pt}
\subsubsection{OPC\_WR\_SL\_DATA\_EXT}
\underline{Operation:} Write extended slot data.

\underline{Group:} \hspace{0.5cm} Variable-Byte Message

\underline{Direction:} \hspace{0.05cm} Command Station $\rightarrow$ 

\underline{Encoding:} 

Byte 0:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
1 & 1 & 1 & 0 & 1 & 1 & 1 & 0\\
\hline
\end{tabular}
& 0xEE & Opcode.\\
\end{tabular}

Byte 1:

\begin{tabular}{p{0.4\linewidth} p{0.15\linewidth} p{0.38\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & 0 & 0 & 1 & 0 & 1 & 0 & 1\\
\hline
\end{tabular}
& 0x15 & Message length (21 bytes).\\
\end{tabular}

Bytes 2 to 19 encode as per extended slot bytes 0 to 17.

Byte 20:

\begin{tabular}{p{0.4\linewidth} p{0.1\linewidth} p{0.5\linewidth}} 

\begin{tabular}{|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|p{0.3cm}|}
\hline
0 & n & n & n & n & n & n & n\\
\hline
\end{tabular}
& $<$CHK$>$ & Checksum.\\
\end{tabular}

\underline{Description:}

This command sends the slot data to the command station.

\underline{Response:} 

Returns OPC\_LONG\_ACK.

\underline{Notes:} 

None.

